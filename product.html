<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ShoeDukaan | Product Details</title>
<meta name="description" content="Discover the best shoes & accessories – all in one place. Shop smart with our mobile-first catalog and curated product grid.">
<meta name="keywords" content="premium shoes, footwear catalog, mobile-first grid, Shoe Dukaan, vertical product images, curated shoes, online shoe store">
<meta name="author" content="ShareDukaan">
<link rel="canonical" href="https://shdkn.carrd.co">
<meta name="robots" content="index, follow">
<link rel="icon" href="shdkn_fav_p.png" type="image/png">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "ShareDukaan",
  "url": "https://shdkn.carrd.co"
}
</script>
<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Barlow:wght@500&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400&display=swap" rel="stylesheet">

<style>
:root {
  --max-width: 1440px;
  --side-padding: 18px;
}

body {
  overflow-x: hidden;
  margin: 0;
  padding: 0;
  font-family: 'Segoe UI', sans-serif;
  background: #1c1c1c;
  scroll-behavior: smooth;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.layout-container {
  max-width: var(--max-width);
  margin: 0 auto;
  padding: 0 var(--side-padding);
  box-sizing: border-box;
}

.wrapper {
  max-width: var(--max-width);
  margin: 0 auto;
  padding: 0 var(--side-padding);
}

/* Header */
.top-banner {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  background-color: #333;
  color: #fff;
  padding: 12px var(--side-padding);
  position: relative;
}

.logo {
  width: 75px;
  height: auto;
  aspect-ratio: 1 / 1;
  object-fit: contain;
}

.header-right {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  text-align: center;
  flex: 1;
}

.tagline {
  font-family: 'Assistant', sans-serif;
  font-size: 12px;
  font-weight: 400;
  margin-bottom: 4px;
}

@media (min-width: 769px) {
  .tagline {
    white-space: normal;
    max-width: 320px;
    line-height: 1.4;
  }
}

.telegram-link {
  font-family: 'Assistant', sans-serif;
  font-size: 13px;
  color: #ffcc00;
  text-decoration: none;
  font-weight: 500;
}

.telegram-link:hover,
.telegram-link:focus {
  transition: background-color 0.3s ease;
  color: inherit;
}

/* Navigation Bar */
.nav-bar {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 6px;
  padding: 6px 0;
  background-color: rgba(30, 30, 30, 0.85);
  backdrop-filter: blur(8px);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  border-top: 1px solid #444;
  border-bottom: 1px solid #444;
}

.nav-list {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  list-style: none;
  margin: 0;
  padding: 0;
}

.nav-list li {
  display: flex;
  align-items: center;
}

.nav-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  width: 40px;
  height: 40px;
  text-decoration: none;
  font-family: 'Assistant', sans-serif;
  font-size: 12px;
  font-weight: 400;
  color: #BABABA;
  text-transform: uppercase;
  overflow: hidden;
  position: relative;
}

.nav-btn img {
  width: 40px;
  height: 40px;
  transition: transform 0.3s ease;
}

.nav-text {
  position: absolute;
  bottom: 0;
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
  font-size: 10px;
  color: #fff;
  text-align: center;
  width: 100%;
}

.nav-btn:hover img {
  transform: scale(0.7);
  transform-origin: top center;
}

.nav-btn:hover .nav-text {
  opacity: 1;
}

.nav-separator {
  color: #555;
  font-size: 14px;
  user-select: none;
}

.nav-btn.active img {
  transform: scale(0.7);
  transform-origin: top center;
}

.nav-btn.active .nav-text {
  opacity: 1;
  color: #fff;
}

/* Back to Top */
#backToTop {
  position: fixed;
  bottom: 24px;
  right: 24px;
  z-index: 100;
  background-color: #ffcc00;
  color: #000;
  border: none;
  border-radius: 20px;
  padding: 10px 18px;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  display: none;
  transition: background-color 0.3s ease, transform 0.3s ease;
}

#backToTop:hover {
  background-color: #ffd633;
  transform: scale(1.05);
}

/* Footer */
.footer-banner {
  width: 100%;
  background-color: #333;
  color: #BDB9B9;
  padding: 4px 0;
  border-top: 1px solid #3A3A3A;
  opacity: 0.85;
  margin-top: 40px;
}

.footer-content {
  text-align: center;
  font-family: 'Inter', sans-serif;
  font-weight: 300;
  font-size: 11px;
  line-height: 1.2;
}

.footer-tagline {
  font-weight: 500;
  margin-bottom: 4px;
}

.footer-branding {
  font-size: 12px;
  margin-bottom: 4px;
}

.footer-disclaimer {
  font-size: 12px;
  opacity: 0.85;
}

/* Product Page Specific Styles */
.product-container {
  max-width: var(--max-width);
  margin: 30px auto;
  padding: 0 var(--side-padding);
  background: transparent;
}

.back-button {
  display: inline-flex;
  align-items: center;
  padding: 8px 18px 8px 0;
  background-color: rgba(30, 30, 30, 0.85);
  color: #BABABA;
  text-decoration: none;
  border-radius: 2px;
  font-family: 'Barlow', sans-serif;
  font-weight: 500;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  margin-bottom: 20px;
  transition: background-color 0.3s ease, opacity 0.3s ease;
}

.back-button:hover {
  color: #005fa3;
  background-color: #3B3B3B;
  opacity: 0.85;
}

.product-detail {
  display: grid;
  grid-template-columns: 1fr;
  gap: 20px;
  margin-bottom: 30px;
}

@media (min-width: 768px) {
  .product-detail {
    grid-template-columns: minmax(0, 420px) 1fr;
  }
}

.product-image-container {
  position: relative;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
  background: #333;
  aspect-ratio: 3 / 5;
  width: 100%;
  max-width: 420px;
  opacity: 0;
  transform: translateY(20px);
  margin: 0 auto;
}

.product-image-container.visible {
  animation: fadeInUp 0.6s ease forwards;
}

.product-image-container .carousel {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
  border-radius: 8px;
  background: #333;
}

.product-image-container .carousel img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  opacity: 0;
  transition: opacity 0.6s ease;
}

.product-image-container .carousel img.active {
  opacity: 1;
  z-index: 1;
}

.product-image-container .carousel img.active:hover {
  filter: brightness(1.08);
  transition: filter 0.3s ease;
}

.product-info {
  padding: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.product-title {
  font-family: 'Inter', sans-serif;
  font-weight: 300;
  font-size: 0.95em;
  color: #BABABA;
  margin: 15px 0;
  line-height: 1.1;
  text-align: left;
}

.product-description {
  font-family: 'Inter', sans-serif;
  font-weight: 300;
  font-size: 0.95em;
  color: #BABABA;
  line-height: 1.4;
  text-align: left;
  margin-bottom: 15px;
}

.product-price {
  font-family: 'Inter', sans-serif;
  font-weight: 300;
  font-size: 0.95em;
  color: #ffcc00;
  text-align: left;
  margin-bottom: 20px;
}

.buy-divider {
  width: 90%;
  height: 1px;
  background-color: #BDB9B9;
  margin: 20px 0;
  border: none;
  opacity: 0.5;
}

.product-actions {
  display: flex;
  gap: 10px;
  width: 100%;
  margin-left: -6px;
  box-sizing: border-box;
}

.buy-button, .share-button {
  margin-top: 5px;
  padding: 8px 18px 8px 0;
  background-color: rgba(30, 30, 30, 0.85);
  color: #BABABA;
  text-decoration: none;
  border-radius: 2px;
  transition: background-color 0.3s ease, opacity 0.3s ease;
  align-self: flex-start;
  border: none;
  cursor: pointer;
  font-family: 'Barlow', sans-serif;
  font-weight: 500;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.buy-button:hover, .share-button:hover {
  color: #005fa3;
  background-color: #3B3B3B;
  opacity: 0.85;
}

.product-features {
  margin: 15px 0;
  padding: 0;
  list-style: none;
}

.product-features li {
  padding: 5px 0;
  font-family: 'Inter', sans-serif;
  font-size: 0.95em;
  color: #BABABA;
  position: relative;
  padding-left: 20px;
  text-align: left;
  line-height: 1.4;
}

.product-features li:before {
  content: "✓";
  position: absolute;
  left: 0;
  color: #ffcc00;
}

.product-meta {
  margin-top: 20px;
  padding-top: 15px;
  border-top: 1px solid #3A3A3A;
  font-family: 'Inter', sans-serif;
  font-size: 0.95em;
  color: #BABABA;
  text-align: left;
}

.similar-products {
  margin-top: 40px;
}

.section-title {
  font-family: 'Inter', sans-serif;
  font-weight: 300;
  font-size: 0.95em;
  color: #BABABA;
  margin-bottom: 20px;
  text-align: left;
  position: relative;
  padding-bottom: 10px;
}

.section-title:after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  width: 50px;
  height: 1px;
  background-color: #3A3A3A;
  opacity: 0.5;
}

.products-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 5px;
  padding: 8px 0;
  width: 100%;
  background-color: #1c1c1c;
}

@media (min-width: 1024px) {
  .products-grid {
    grid-template-columns: repeat(4, 1fr);
  }
}

.product-card {
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  padding: 6px;
  width: 100%;
  max-width: 420px;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
  box-sizing: border-box;
  aspect-ratio: 3 / 5;
  overflow: hidden;
  opacity: 0;
  transform: translateY(20px);
}

.product-card.visible {
  animation: fadeInUp 0.6s ease forwards;
}

.product-card:hover {
  transform: scale(1.03);
  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.16);
}

.product-card .carousel {
  position: relative;
  width: 100%;
  height: 60%;
  overflow: hidden;
  border-radius: 8px;
  background: #333;
}

.product-card .carousel img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  opacity: 0;
  transition: opacity 0.6s ease;
}

.product-card .carousel img.active {
  opacity: 1;
  z-index: 1;
}

.product-card .carousel img.active:hover {
  filter: brightness(1.08);
  transition: filter 0.3s ease;
}

.product-card-title {
  font-family: 'Inter', sans-serif;
  font-weight: 300;
  font-size: 0.95em;
  color: #BABABA;
  margin-top: 15px;
  line-height: 1.1;
  text-align: center;
  max-width: 90%;
  margin: 0 auto;
}

.product-card-price {
  font-family: 'Inter', sans-serif;
  font-weight: 300;
  font-size: 0.95em;
  color: #ffcc00;
  text-align: center;
  margin: 8px 0;
}

.product-card-actions {
  padding: 0;
  width: 100%;
  margin-top: 10px;
}

.product-card-link {
  display: block;
  padding: 8px 18px 8px 0;
  background-color: rgba(30, 30, 30, 0.85);
  color: #BABABA;
  text-decoration: none;
  border-radius: 2px;
  transition: background-color 0.3s ease, opacity 0.3s ease;
  text-align: center;
  font-family: 'Barlow', sans-serif;
  font-weight: 500;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.product-card-link:hover {
  color: #005fa3;
  background-color: #3B3B3B;
  opacity: 0.85;
}

.spacer {
  height: 20px;
}

.loading-message {
  text-align: center;
  padding: 60px 20px;
  font-family: 'Inter', sans-serif;
  font-size: 18px;
  color: #BABABA;
}

.error-message {
  text-align: center;
  padding: 60px 20px;
  font-family: 'Inter', sans-serif;
  font-size: 18px;
  color: #ff6b6b;
}

.loading-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255,255,255,.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 1s ease-in-out infinite;
  margin-right: 10px;
  vertical-align: middle;
}

@media (max-width: 768px) {
  .product-detail {
    grid-template-columns: 1fr;
    gap: 15px;
  }
  
  .product-image-container {
    aspect-ratio: 3 / 5;
    max-width: 420px;
    margin: 0 auto;
  }
  
  .product-actions {
    flex-direction: row;
    margin-left: -6px;
  }
  
  .products-grid {
    grid-template-columns: 1fr;
    gap: 10px;
  }
  
  .product-card {
    aspect-ratio: 3 / 5;
    padding: 6px;
  }
  
  .top-banner {
    padding: 12px 16px;
  }
  
  .header-right {
    align-items: flex-start;
    text-align: right;
    width: 100%;
  }
  
  .telegram-link {
    display: block;
    margin-left: auto;
    margin-right: 0;
    text-align: right;
  }
  
  .telegram-link:hover,
  .telegram-link:focus {
    transition: background-color 0.3s ease;
    color: inherit;
  }
  
  .tagline {
    display: block;
    margin-left: auto;
    margin-right: 0;
    text-align: right;
  }
  
  .logo {
    height: 100px;
    margin-bottom: 8px;
  }
}
</style>
</head>
<body>
<div class="wrapper">
  <!-- Header -->
  <header class="top-banner layout-container">
    <div class="header-left">
      <img src="https://i.imgur.com/hp0QbkV.jpeg" alt="ShareDukaan Logo" class="logo">
    </div>
    <div class="header-right">
      <p class="tagline">Discover The Best Shoes & Accessories – All in One Place | Shop Smart!!</p>
      <a href="https://t.me/sharedukaan" class="telegram-link">For daily updates 👉 Telegram</a>
    </div>
  </header>

  <!-- Navigation -->
  <nav class="nav-bar layout-container" role="navigation" aria-label="Main site navigation">
    <ul class="nav-list">
      <li>
        <a href="index.html" class="nav-btn">
          <img src="assets/Home_P.png" alt="Explore" width="40" height="40" />
          <span class="nav-text">Explore</span>
        </a>
      </li>
      <li><span class="nav-separator">|</span></li>
      <li>
        <a href="forhim.html" class="nav-btn">
          <img src="assets/Men_P.png" alt="For Him" width="40" height="40" />
          <span class="nav-text">For Him</span>
        </a>
      </li>
      <li><span class="nav-separator">|</span></li>
      <li>
        <a href="forher.html" class="nav-btn">
          <img src="assets/Women_P.png" alt="For Her" width="40" height="40" />
          <span class="nav-text">For Her</span>
        </a>
      </li>
      <li><span class="nav-separator">|</span></li>
      <li><a href="https://shoedukaan.blogspot.com" class="nav-btn">Blog >></a></li>
    </ul>
  </nav>

  <!-- Product Content -->
  <main class="layout-container">
    <a href="index.html" class="back-button">← Back to Home</a>
    
    <div class="product-container">
      <div id="productLoading" class="loading-message">
        <span class="loading-spinner"></span> Loading product details...
      </div>
      
      <div id="productError" class="error-message" style="display: none;">
        Product not found. Please check the URL or return to the homepage.
      </div>
      
      <div id="productDetail" class="product-detail" style="display: none;">
        <!-- Product content will be inserted here by JavaScript -->
      </div>
    </div>
    
    <div class="similar-products">
      <h2 class="section-title">You Might Also Like</h2>
      <div id="similarProducts" class="products-grid">
        <!-- Similar products will be inserted here by JavaScript -->
      </div>
    </div>
  </main>
</div>

<!-- Back to Top Button -->
<button id="backToTop" title="Back to Top">Top</button>

<!-- Footer -->
<footer class="footer-banner">
  <div class="layout-container">
    <div class="footer-content">
      <p class="footer-tagline">Inspired by Google Keep's brilliant simplicity</p>
      <p class="footer-branding">© 2025 ShareDukaan. All rights reserved.</p>
      <p class="footer-disclaimer">
        Disclaimer: ShareDukaan is a participant in the Amazon Associates Program. We may earn a small commission when you purchase through affiliate links, at no extra cost to you. Product prices and availability are subject to change. The actual product may differ slightly from the images shown above.
      </p>
    </div>
  </div>
</footer>

<!-- JavaScript -->
<script>
  // Utility function to escape quotes
  function escapeQuotes(str) {
    return String(str).replace(/"/g, '&quot;');
  }

  // Colors for product cards
  const colors = [
    "#3A3647", "#1C262E", "#692B17",
    "#0C625D", "#5A6361", "#4B455E", "#596C39", "#396C5D", "#6C394F", "#284255"
  ];

  // Get URL parameters
  function getUrlParams() {
    const params = new URLSearchParams(window.location.search);
    return {
      permanentId: params.get('permanentId'),
      source: params.get('source')
    };
  }

  // Activate carousels
  function activateCarousels(selector = ".carousel") {
    document.querySelectorAll(selector).forEach((carousel, index) => {
      if (carousel.dataset.activated === "true") return;
      carousel.dataset.activated = "true";

      const images = carousel.querySelectorAll("img");
      if (images.length <= 1) return;

      let current = 0;

      function shuffle() {
        images.forEach((img, i) => img.classList.toggle("active", i === current));
        current = (current + 1) % images.length;

        const seed = Number(carousel.dataset.seed) || index;
        const nextDelay = 2000 + (seed % 3000);
        setTimeout(shuffle, nextDelay);
      }

      const initialDelay = Math.floor(Math.random() * 3000);
      setTimeout(shuffle, initialDelay);
    });
  }

  // Intersection Observer
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      entry.target.classList.toggle('visible', entry.isIntersecting);
    });
  }, {
    threshold: 0.1
  });

  // Load product details
  async function loadProductDetail() {
    const { permanentId, source } = getUrlParams();
    
    if (!permanentId) {
      showError();
      return;
    }
    
    try {
      const sheetID = "1z06jsVC54KkbyH_X3oGwmChEPyP1jrMl625LV5VP7Uw";
      const categories = ['links', 'for-him', 'for-her'];
      
      let product = null;
      
      for (const category of categories) {
        const url = `https://opensheet.elk.sh/${sheetID}/${category}`;
        const res = await fetch(url);
        
        if (!res.ok) {
          console.error(`Failed to fetch ${category} category: ${res.status}`);
          continue;
        }
        
        const data = await res.json();
        const foundProduct = data.find(item => item.permanentId === permanentId);
        
        if (foundProduct) {
          product = { ...foundProduct, category };
          break;
        }
      }
      
      if (product) {
        displayProduct(product);
        loadSimilarProducts(product.category, permanentId);
      } else {
        showError();
      }
    } catch (err) {
      console.error("Failed to load product:", err);
      showError();
    }
  }
  
  // Display product details
  function displayProduct(product) {
    const productDetail = document.getElementById('productDetail');
    const productLoading = document.getElementById('productLoading');
    
    productLoading.style.display = 'none';
    productDetail.style.display = 'grid';
    
    const imageArray = product.img ? product.img.split(',').map(url => url.trim()).filter(url => url) : [];
    const carouselHTML = imageArray.length > 0 ? 
      imageArray.map((url, i) => 
        `<img src="${url}" class="${i === 0 ? 'active' : ''}" loading="lazy" alt="${product.title || 'Product Image'}" onerror="this.src='https://via.placeholder.com/300x500?text=No+Image';" />`
      ).join('') : 
      `<img src="https://via.placeholder.com/300x500?text=No+Image" class="active" loading="lazy" alt="No Image" />`;
    
    const productHTML = `
      <div class="product-image-container" role="region" aria-label="Product images">
        <div class="carousel" data-seed="${product.shuffleID || 0}">
          ${carouselHTML}
        </div>
      </div>
      <div class="product-info">
        <h3 class="product-title">${product.title || 'Unknown Product'}</h3>
        ${product.description ? `<div class="product-description">${product.description}</div>` : ''}
        ${product.price ? `<div class="product-price">${product.price}</div>` : ''}
        ${product.features ? `
          <ul class="product-features">
            ${product.features.split(',').map(feature => `<li>${feature.trim()}</li>`).join('')}
          </ul>
        ` : ''}
        <div class="buy-divider"></div>
        <div class="product-actions">
          <a href="${product.link || '#'}" target="_blank" class="buy-button" aria-label="Buy ${product.title || 'product'}">👉👉 Buy Now</a>
          <button class="share-button" data-title="${escapeQuotes(product.title || 'product')}" data-image="${imageArray[0] || ''}" data-url="${escapeQuotes(product.link || '#')}" data-id="${escapeQuotes(product.permanentId || '0')}" aria-label="Share ${product.title || 'product'}">📤 Share</button>
        </div>
        <div class="product-meta">
          ${product.category ? `<div><strong>Category:</strong> ${product.category}</div>` : ''}
        </div>
      </div>
    `;
    
    productDetail.innerHTML = productHTML;
    document.title = `${product.title || 'Product'} | ShoeDukaan`;
    
    const imageContainer = productDetail.querySelector('.product-image-container');
    observer.observe(imageContainer);
    activateCarousels('.product-image-container .carousel');
  }
  
  // Load similar products
  async function loadSimilarProducts(category, excludeId) {
    try {
      const sheetID = "1z06jsVC54KkbyH_X3oGwmChEPyP1jrMl625LV5VP7Uw";
      const url = `https://opensheet.elk.sh/${sheetID}/${category}`;
      const res = await fetch(url);
      
      if (!res.ok) {
        console.error(`Failed to fetch similar products for ${category}: ${res.status}`);
        return;
      }
      
      const data = await res.json();
      console.log(`Fetched similar products for ${category}:`, data); // Debug log
      const similarProducts = data
        .filter(item => item.permanentId !== excludeId && item.title && item.img && item.link)
        .sort(() => 0.5 - Math.random())
        .slice(0, 4);
      
      console.log(`Filtered similar products:`, similarProducts); // Debug log
      displaySimilarProducts(similarProducts);
    } catch (err) {
      console.error("Failed to load similar products:", err);
      document.getElementById('similarProducts').innerHTML = '<div class="error-message">Failed to load similar products.</div>';
    }
  }
  
  // Display similar products
  function displaySimilarProducts(products) {
    const similarProductsContainer = document.getElementById('similarProducts');
    
    if (products.length === 0) {
      similarProductsContainer.innerHTML = '<div class="error-message">No similar products found.</div>';
      return;
    }
    
    const productsHTML = products.map((product, i) => {
      const imageArray = product.img ? product.img.split(',').map(url => url.trim()).filter(url => url) : [];
      console.log(`Product ${product.title} images:`, imageArray); // Debug log
      const carouselHTML = imageArray.length > 0 ? 
        imageArray.map((url, i) => 
          `<img src="${url}" class="${i === 0 ? 'active' : ''}" loading="lazy" alt="${product.title}" onerror="this.src='https://via.placeholder.com/300x500?text=No+Image';" />`
        ).join('') : 
        `<img src="https://via.placeholder.com/300x500?text=No+Image" class="active" loading="lazy" alt="No Image" />`;
      
      return `
        <article class="product-card" role="article" aria-label="${product.title}" style="background-color: ${colors[i % colors.length]}; transition-delay: ${i * 100}ms;">
          <div class="carousel" data-seed="${product.shuffleID || i}">
            ${carouselHTML}
          </div>
          <div class="spacer"></div>
          <h3 class="product-card-title">${product.title}</h3>
          ${product.price ? `<div class="product-card-price">${product.price}</div>` : ''}
          <div class="buy-divider"></div>
          <div class="product-card-actions">
            <a href="product.html?permanentId=${product.permanentId}&source=${product.category}" class="product-card-link" aria-label="View ${product.title} details">View Details</a>
          </div>
        </article>
      `;
    }).join('');
    
    similarProductsContainer.innerHTML = productsHTML;
    
    similarProductsContainer.querySelectorAll('.product-card').forEach(card => observer.observe(card));
    activateCarousels('.product-card .carousel');
  }
  
  // Show error message
  function showError() {
    const productLoading = document.getElementById('productLoading');
    const productError = document.getElementById('productError');
    
    productLoading.style.display = 'none';
    productError.style.display = 'block';
  }
  
  // Share product function
  async function shareProduct(title, image, buyUrl, permanentId) {
    const { source } = getUrlParams();
    const productPageUrl = `https://sharedukaan.github.io/shdknlinks/product.html?permanentId=${permanentId}&source=${source || 'direct'}`;
    
    const shareData = {
      title: title,
      text: `Check out ${title} on ShoeDukaan!`,
      url: productPageUrl
    };
    
    if (navigator.share) {
      try {
        await navigator.share(shareData);
      } catch (error) {
        if (error.name !== 'AbortError') {
          copyToClipboard(productPageUrl, title);
        }
      }
    } else {
      copyToClipboard(productPageUrl, title);
    }
  }
  
  // Fallback function to copy to clipboard
  function copyToClipboard(text, productTitle) {
    navigator.clipboard.writeText(text).then(() => {
      alert(`Link for "${productTitle}" copied to clipboard!`);
    }).catch(err => {
      console.error('Could not copy text: ', err);
      prompt('Copy this URL to share:', text);
    });
  }
  
  // Event delegation for share buttons
  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('share-button')) {
      const title = e.target.dataset.title;
      const image = e.target.dataset.image;
      const buyUrl = e.target.dataset.url;
      const permanentId = e.target.dataset.id;
      
      shareProduct(title, image, buyUrl, permanentId);
    }
  });
  
  // Initialize the page
  window.addEventListener("DOMContentLoaded", function() {
    loadProductDetail();
    
    window.addEventListener("scroll", () => {
      const scrollY = window.scrollY;
      const backToTopBtn = document.getElementById("backToTop");
      if (backToTopBtn) {
        backToTopBtn.style.display = scrollY > 300 ? "block" : "none";
      }
    });

    const backToTopBtn = document.getElementById("backToTop");
    if (backToTopBtn) {
      backToTopBtn.addEventListener("click", () => {
        window.scrollTo({ top: 0, behavior: "smooth" });
      });
    }
    
    document.querySelectorAll('.nav-btn').forEach(link => {
      if (link.href === window.location.href) {
        link.classList.add('active');
      }
    });
  });
</script>
</body>
</html>